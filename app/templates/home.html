<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>mugic - home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
    /* background */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    html {
        font-size: 10px;
        font-family: "Lato", Arial, sans-serif;
    }
    
    section {
        width: 100%;
        height: 100vh;
        color: #fff;
        background: linear-gradient(-45deg, #EE7752, #E73C7E, #23A6D5, #23D5AB);
        background-size: 400% 400%;
        position: relative;
        animation: change 20s ease-in-out infinite;
    }
    
    @keyframes change {
        0% {
            background-position: 0 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0 50%;
        }
    }
    
    /* nav buttons */
    .nav-button {
        width: 120px;
        height: 35px;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-align: center;
    }
    
    .nav-button:hover {
        background: #fce;
        box-shadow: 0 0 5px #fce, 0 0 10px #fce, 0 0 15px #fce;
        cursor: pointer;
    }
    
    /* avator */
    #avatar {
        background-image: url('{{user_avator}}');
        width: 100px;
        height: 100px;
        background-size: cover;
        background-position: top center;
        border-radius: 50%;
        position: absolute;
        left: 50%;
        top: 70px;
        margin-left: -50px;
        margin-top: -50px;
    }
    
    /* generate button */
    .element-hidden {
        visibility: hidden;
    }
    
    .generate {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: inline-block;
        padding: 15px 30px;
        color: #fff;
        text-transform: uppercase;
        letter-spacing: 4px;
        text-decoration: none;
        font-size: 24px;
        overflow: hidden;
        transition: 0.2s;
    }
    
    .generate:hover {
        color: #255784;
        background: #2196f3;
        box-shadow: 0 0 10px #2196f3, 0 0 40px #2196f3, 0 0 80px #2196f3;
        transition-delay: 1s;
    }
    
    .generate span {
        position: absolute;
        display: block;
    }
    
    .generate span:nth-child(1) {
        top: 0;
        left: -100%;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #fff);
    }
    
    .generate:hover span:nth-child(1) {
        left: 100%;
        transition: 1s;
    }
    
    .generate span:nth-child(3) {
        bottom: 0;
        right: -100%;
        width: 100%;
        height: 2px;
        background: linear-gradient(270deg, transparent, #fff);
    }
    
    .generate:hover span:nth-child(3) {
        right: 100%;
        transition: 1s;
        transition-delay: 0.5s;
    }
    
    .generate span:nth-child(2) {
        top: -100%;
        right: 0;
        width: 2px;
        height: 100%;
        background: linear-gradient(180deg, transparent, #fff);
    }
    
    .generate:hover span:nth-child(2) {
        top: 100%;
        transition: 1s;
        transition-delay: 0.25s;
    }
    
    .generate span:nth-child(4) {
        bottom: -100%;
        left: 0;
        width: 2px;
        height: 100%;
        background: linear-gradient(360deg, transparent, #fff);
    }
    
    .generate:hover span:nth-child(4) {
        bottom: 100%;
        transition: 1s;
        transition-delay: 0.75s;
    }
    
    /* piechart */
    .piechart {
        width: 320px;
        height: 200px;
        position: absolute;
        left: 38%;
    }
    
    /* playlist */
    .music-container-user {
        font-family: sans-serif;
        width: 350px;
        left: 20%;
        top: 50%;
        transform: translate(-50%, -50%);
        display: block;
        position: absolute;
        background: #add8e6;
        opacity: 0.8;
        color: #000;
    }
    
    .music-container-gen {
        font-family: sans-serif;
        width: 350px;
        right: 20%;
        top: 50%;
        transform: translate(50%, -50%);
        display: block;
        position: absolute;
        background: #add8e6;
        opacity: 0.8;
        color: #000;
    }
    
    .music-header {
        width: 100%;
        height: 60px;
        background: #add8e6;
        color: #000;
    }
    
    .music-header .title {
        width: 250px;
        height: 30px;
        position: absolute;
        margin-top: 10px;
        margin-left: 45px;
        text-align: center;
    }
    
    .music-playlist {
        width: 100%;
        height: 450px;
    }
    
    .music-menu {
        width: 100%;
        height: 28px;
    }
    
    .menu {
        width: 275px;
        height: 20px;
        margin: 5px 30px auto;
    }
    
    .menu ul {
        font-size: 10px;
        padding: initial;
    }
    
    .menu ul li {
        list-style-type: none;
        display: inline-block;
        border-right: 1px solid #000;
    }
    
    .menu ul li:hover {
        background: #fce;
        box-shadow: 0 0 5px #fce, 0 0 10px #fce, 0 0 15px #fce;
    }
    
    .menu ul li a {
        color: #000;
        padding: 5px 40px;
        text-decoration: none;
        letter-spacing: 0.5px;
    }
    
    .menu ul li:last-child {
        border-right: none;
    }
    
    .playlist-box {
        width: 100%;
        height: 410px;
        overflow: scroll;
        overflow-x: hidden;
    }
    
    .playlist-box::-webkit-scrollbar {
        width: 0px;
        background: transparent;
    }
    
    .playlist-box .fa-circle-o {
        margin-right: 10px;
        margin-top: 22px;
        font-weight: normal;
        color: #000;
    }
    
    .playlist-box .fa-check-circle-o {
        margin-right: 10px;
        margin-top: 22px;
        font-weight: normal;
        color: #00ff00;
    }
    
    .playlist-box .fa-exclamation-circle {
        margin-right: 10px;
        margin-top: 22px;
        font-weight: normal;
        color: #000;
    }
    
    .playlist-info {
        width: 100%;
        height: 60px;
        display: flex;
    }
    
    .playlist-info:hover {
        background: #fce;
        box-shadow: 0 0 5px #fce, 0 0 10px #fce, 0 0 15px #fce;
        cursor: pointer;
    }
    
    .playlist-img {
        width: 60px;
        height: 60px;
    }
    
    .playlist-img img {
        width: 50px;
        height: 50px;
        margin: 2px 5px;
        padding: 1px;
    }
    
    .playlist-name {
        width: 300px;
        padding: 0 5px;
        height: 60px;
    }
    
    .playlist-name h6 {
        margin-top: 7px;
        font-size: 15px;
        font-weight: normal;
        letter-spacing: 0.5px;
        line-height: 15px;
    }
    
    .playlist-name p {
        font-size: 8px;
        font-style: italic;
        letter-spacing: 0.5px;
        line-height: 1px;
    }
    
    hr {
        width: 95%;
        margin-top: 4px !important;
        margin-bottom: 6px !important;
    }
    
    .track-preview {
        width: 100%;
        height: 12px;
        display: flex;
    }
    
    .ex-mask{ 
        width: 100%;height:100%;background: #000;
        position: absolute;top: 0px;height: 0px;z-index: 8000;
        opacity:0.4; filter: Alpha(opacity=40);
    }

    .ex-window{ 
        width: 300px;height: auto;display: none;
        position: absolute;z-index: 9000;
        top: 0px;left: 0px;
        border: 1px solid #D5D5D5;background: #fff;
    }

    .ex-window a{text-decoration: none;}

    .ex-window-title{
        height: 48px;line-height: 48px; padding:0px 20px;color: #535353;font-size: 16px;font-weight: 800;
        border-bottom: 1px solid #efefef;background: #fff3f4;
        cursor: move;
        user-select:none;
    }

    .ex-window-closebutton{
        width: 16px;height: 16px;display: block;
        position: absolute;top: 12px;right: 20px;
        background: url(../static/img/close_def.png) no-repeat;cursor: pointer;
    }

    .ex-window-closebutton:hover{background:url(../static/img/close_hov.png);}

    .ex-window-content{
        padding: 15px 20px;
    }

    .ex-window-pt15{
        padding-top: 15px;
    }

    .ex-window-l40{
        height: 40px;line-height: 40px;
        text-align: right;
    }

    .ex-window-input{
        width: 100%;height: 50px;
        margin: 0px;padding:0px;
        border: 1px solid #d5d5d5;
        font-size: 16px;color: #3a3a3a;
        text-indent: 55px;
        outline: none;
		border-radius: 10px
    }

    .ex-window-input-playlistname{
        background: url(../static/img/playlist.png) no-repeat 2px ;
    }

    .ex-window-submit{
        width: 80%;height: 50px;background: #1db954;border:initial;font-size: 16px;color: #e7e7e7;
		margin: auto;
        outline: none;text-decoration: none;
        display: block;text-align: center;line-height: 50px;
		font-weight: 600;
		border-radius: 50px
    }

    .ex-window-submit:hover{
        background: #1fdd58;
		color: #fff;
		font-size: 17px;
    }
	
	.ex-window-msg{
		height: 30px;line-height: 30px;
		text-align: left;
		color: #d90000;
	}

    </style>
</head>
<body>
    <section>
        <!-- user playlists -->
        <div id='user-playlist' class='music-container-user'>
            <div class='music-header'>
                <div class='title'><h2>My Playlists</h2></div>
            </div>
            <div class='music-playlist'>
                <div class='playlist-box'>
                    {% for playlist_name in playlist_names %}
                    {% if playlist_tracks[loop.index0]|length > 0 %}
                        <div class='playlist-info' onclick="toggleTracks('{{'track-playlist'+loop.index|string}}', {{ loop.index0 }}, this)">
                            <div class='playlist-img'>
                                <img src="{{playlist_covers[loop.index0]}}">
                            </div>
                            <div class='playlist-name'>
                                <h6>{{playlist_name}}</h6>
                                <p>{{playlist_descriptions[loop.index0]}}</p>
                            </div>
                            <i class="fa fa-circle-o"></i>
                        </div><hr>
                        <div class='track-box' id='{{'track-playlist'+loop.index|string}}' style="display:none">
                            {% for track in playlist_tracks[loop.index0] %}
                            <p style="margin-left: 20px; margin-right: 20px;"><b>{{loop.index}}. </b>{{track.name}} - <i>{{track.artist}}</i></p>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class='playlist-info'>
                            <div class='playlist-img'>
                                <img src="{{playlist_covers[loop.index0]}}">
                            </div>
                            <div class='playlist-name'>
                                <h6>{{playlist_name}}</h6>
                                <p>{{playlist_descriptions[loop.index0]}}</p>
                            </div>
                            <i class="fa fa-exclamation-circle"></i>
                        </div><hr>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- generated playlist -->
        {% if gen_track_names|length > 0 %}
        <div id='generated-playlist' class='music-container-gen'>
            <div class='music-header'>
                <div class='title'>
                    <h2>Generated Playlist</h2>
                    <h4>Inspired by <i>{{pl_name}}</i></h4>
                </div>
            </div>
            <div class='music-playlist'>
                <div class='playlist-box'>
                    {% for gen_track_name in gen_track_names %}
                    <div class='playlist-info'>
                        <div class='playlist-img'>
                            <img src="{{gen_track_covers[loop.index0]}}">
                                </div>
                        <div class='playlist-name'>
                            <h6>{{gen_track_name}}</h6>
                            <p>{{gen_track_artists[loop.index0]}}</p>
                        </div>
                    </div>
                    <div class='track-preview'><audio controls style='height: 15px;'><source src="{{gen_track_previews[loop.index0]}}"></audio></div>
                    <hr>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class='nav-button' style='position:absolute; bottom:30px; right:30px;'>
            <a href='javascript:showEXWindow()' style='color: #fff;'>EXPORT</a>
        </div>

        <div class='ex-mask' id='mask' onselectstart='return false'></div>

        <div class='ex-window' id='winMove' onselectstart='return false;'>
            <div class='ex-window-title' id='winDrag' onselectstart='return false;'>
                Export Your Playlist
                <a class='ex-window-closebutton' href='javascript:hideWindow();'></a>
            </div>

            <div class='ex-window-content'>
                <div class='ex-window-140 ex-window-pt15'>
                    <input class='ex-window-input ex-window-input-playlistname' type='input' placeholder='New Playlist Name' value=''>
                </div>
				<div class='ex-window-msg'>
					<p>
						{{warning msg}}
					</p>
				</div>
                <div>
                    <a class='ex-window-submit' href='exportList()'>
                        Creat & Export Playlist
                    </a>
                </div>
            </div>
        </div>

        {% endif %}
        
        <a id='generate-button' class='generate element-hidden' href='#' onclick="generate(this);" disabled>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            GENERATE >>
        </a>
        
        <div class='nav-button' style='position:absolute; top:30px; right:30px;'><a href='{{url_for('logout')}}' style='color: #fff;'>LOGOUT</a></div>
        <div class='nav-button' style='position:absolute; top:30px; left:30px;'><a href='{{url_for('index')}}' style='color: #fff;'>BACK</a></div>
        <div class='nav-button' style='position:absolute; bottom:30px; left:30px;'><a href='{{url_for('history')}}' style='color: #fff;'>HISTORY</a></div>
        
        <div id="avatar"></div>
        
        <div class="piechart" id="piechart-genre" style="bottom:-10px;"></div>
        <div class="piechart" id="piechart-artist" style="bottom:150px;"></div>
    </section>
    
    <!-- playlist script -->
    <script>
        var selectedPlIndex = -1;
        var plIds = {{ playlist_ids|safe }};
        
        function generate(obj) {
            if (selectedPlIndex >= 0) {
                obj.href="/generation/".concat(plIds[selectedPlIndex].toString());
            }
        }
        
        function toggleTracks(playlistID, index, obj) {
            var e = document.getElementById(playlistID);
            if (e.style.display == "none") {
                gen_button = document.getElementById("generate-button");
                try {
                    gen_button.disabled = false;
                    gen_button.classList.remove("element-hidden");
                }
                catch(err) {
                    
                }
                
                selectedPlIndex = index;
                
                e.style.display = "block";
                
                var unchecked = obj.getElementsByClassName("fa fa-circle-o")[0];
                var checked = document.createElement("i");
                checked.className = "fa fa-check-circle-o";
                unchecked.parentNode.replaceChild(checked, unchecked);
                
                // collapse and uncheck all other playlists
                var trackBoxes = obj.parentNode.getElementsByClassName("track-box");
                var i;
                for (i = 0; i < trackBoxes.length; i++) {
                    if (trackBoxes[i].id !== playlistID) {
                        trackBoxes[i].style.display = "none";
                    }
                }
                var playlists = obj.parentNode.getElementsByClassName("playlist-info");
                var i;
                for (i = 0; i < playlists.length; i++) {
                    if (playlists[i] !== obj) {
                        if (playlists[i].getElementsByClassName("fa fa-check-circle-o").length !== 0) {
                            var checked = playlists[i].getElementsByClassName("fa fa-check-circle-o")[0];
                            var unchecked = document.createElement("i");
                            unchecked.className = "fa fa-circle-o";
                            checked.parentNode.replaceChild(unchecked, checked);
                        }
                    }
                }
            }
            else {
                gen_button = document.getElementById("generate-button");
                try {
                    gen_button.disabled = true;
                    gen_button.classList.add("element-hidden");
                }
                catch(err) {
                    
                }
                
                selectedPlIndex = -1;
                
                e.style.display = "none";
                
                var checked = obj.getElementsByClassName("fa fa-check-circle-o")[0];
                var unchecked = document.createElement("i");
                unchecked.className = "fa fa-circle-o";
                checked.parentNode.replaceChild(unchecked, checked);
            }
        }
    </script>
	
	<!-- Export window script -->
	<script type='text/javascript'>
		
		var winInstace , onMoveStartId , mousePos = {x:0,y:0};
		
		function g(id){return document.getElementById(id);}
		
		function autoCenter( el ){
			var bodyW = document.documentElement.clientWidth;
			var bodyH = document.documentElement.clientHeight;
		
			var elW = el.offsetWidth;
			var elH = el.offsetHeight;
		
			el.style.left = (bodyW-elW)/2 + 'px';
			el.style.top = (bodyH-elH)/2 + 'px';
		}
		
		function fillToBody( el ){
			el.style.width  = document.documentElement.clientWidth  +'px';
			el.style.height = document.documentElement.clientHeight + 'px';
		}
		
		function Window( dragId , moveId ){
		
			var instace = {} ;
		
			instace.dragElement  = g(dragId);
			instace.moveElement  = g(moveId);
		
			instace.mouseOffsetLeft = 0;
			instace.mouseOffsetTop = 0;	
	
			instace.dragElement.addEventListener('mousedown',function(e){
		
				var e = e || window.event;
		
				dialogInstace = instace;
				instace.mouseOffsetLeft = e.pageX - instace.moveElement.offsetLeft ;
				instace.mouseOffsetTop  = e.pageY - instace.moveElement.offsetTop ;
				
				onMoveStartId = setInterval(onMoveStart,10);
				return false;
				// instace.moveElement.style.zIndex = zIndex ++;
			})
		
			return instace;
		}
		
		document.onmouseup = function(e){
			dialogInstace = false;
			clearInterval(onMoveStartId);
		}
		document.onmousemove = function( e ){
			var e = window.event || e;
			mousePos.x = e.clientX;
			mousePos.y = e.clientY;
					
			e.stopPropagation && e.stopPropagation();
			e.cancelBubble = true;
			e = this.originalEvent;
	        e && ( e.preventDefault ? e.preventDefault() : e.returnValue = false );
		
	        document.body.style.MozUserSelect = 'none';
		}	
		
		function onMoveStart(){
		
			var instace = dialogInstace;
		    if (instace) {
		    	var maxX = document.documentElement.clientWidth -  instace.moveElement.offsetWidth;
		    	var maxY = document.documentElement.clientHeight - instace.moveElement.offsetHeight ;
		
				instace.moveElement.style.left = Math.min( Math.max( ( mousePos.x - instace.mouseOffsetLeft) , 0 ) , maxX) + "px";
				instace.moveElement.style.top  = Math.min( Math.max( ( mousePos.y - instace.mouseOffsetTop ) , 0 ) , maxY) + "px";
		    }
		}
		
		function showEXWindow(){
			g('winMove').style.display = 'block';
			g('mask').style.display = 'block';
			autoCenter( g('winMove') );
			fillToBody( g('mask') );
		}
		
		function hideWindow(){
			g('winMove').style.display = 'none';
			g('mask').style.display = 'none';
		}

		window.onresize = showEXWindow;
		
		Window('winDrag','winMove');
		
		showDialog();
	</script>
    
    <!-- pie chart script -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);
        
        function drawChart() {
            if ({{ gen_genres|safe }}.length == 0 || {{ gen_artists|safe }}.length == 0) {
                return;
            }
            
            var genres = [['Genre', 'Number of Tracks']];
            var i;
            for (i = 0; i < {{ gen_genres|safe }}.length; i++) {
                genres.push([{{ gen_genres|safe }}[i][0], {{ gen_genres|safe }}[i][1]]);
            }
            
            var artists = [['Artist', 'Number of Tracks']];
            for (i = 0; i < {{ gen_artists|safe }}.length; i++) {
                artists.push([{{ gen_artists|safe }}[i][0], {{ gen_artists|safe }}[i][1]]);
            }
            
            try {
                var data_genre = google.visualization.arrayToDataTable(genres);
                
                var data_artist = google.visualization.arrayToDataTable(artists);
                
                var options = {
                    backgroundColor: { fill:'transparent' }
                };
                
                var chart_genre = new google.visualization.PieChart(document.getElementById('piechart-genre'));
                var chart_artist = new google.visualization.PieChart(document.getElementById('piechart-artist'));
                
                chart_genre.draw(data_genre, options);
                chart_artist.draw(data_artist, options);
            }
            catch(err) {
                alert(err.message);
            }
        }
    </script>
</body>
</html>
